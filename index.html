<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Marriage Type Assessment ‚Äî Interactive (Email-Only)</title>
  <meta name="description"
    content="Conversational, faith-inspired marriage assessment. One question at a time. Private, anonymous. Results are emailed to you." />
  <style>
    :root {
      --bg: #faf7f2;
      --card: #ffffff;
      --ink: #1f2937;
      --muted: #6b7280;
      --border: #e7e5e4;
      --gold: #b38b2e;
      --plum: #6d4aa1;
      --ok: #0a7b50;
      --warn: #b7791f;
      --bad: #b91c1c;
      --shadow: 0 10px 40px rgba(17, 24, 39, .08);
      --radius: 18px;
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      line-height: 1.6
    }

    .container {
      max-width: 760px;
      margin: 28px auto;
      padding: 0 16px
    }

    .hero {
      background: linear-gradient(180deg, rgba(255, 255, 255, .7), #fff);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 22px
    }

    h1 {
      margin: 0 0 8px;
      font-weight: 800;
      letter-spacing: .2px
    }

    .subtitle {
      color: var(--muted);
      margin: 0
    }

    .badge {
      display: inline-block;
      font-size: 12px;
      color: #fff;
      background: linear-gradient(90deg, var(--gold), #e6c56c);
      padding: 5px 10px;
      border-radius: 999px;
      margin-left: 8px
    }

    .progress {
      height: 12px;
      background: #f3f4f6;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid var(--border);
      margin-top: 12px
    }

    .bar {
      height: 100%;
      background: linear-gradient(90deg, var(--gold), #e6c56c);
      width: 0%
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 22px;
      margin-top: 18px
    }

    .qnum {
      color: var(--gold);
      font-weight: 700
    }

    .section {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      background: #f6f3ff;
      border: 1px solid #e9e3ff;
      color: var(--plum);
      font-size: 12px
    }

    .scale {
      display: grid;
      gap: 10px;
      margin-top: 14px
    }

    .opt {
      padding: 14px 14px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #fff;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px
    }

    .opt:hover {
      border-color: #e6c56c;
      box-shadow: 0 2px 10px rgba(0, 0, 0, .04)
    }

    .opt input {
      margin: 0
    }

    .nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-top: 16px
    }

    .btn {
      padding: 10px 16px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #fff;
      cursor: pointer;
      font-weight: 600
    }

    .btn.primary {
      background: linear-gradient(90deg, var(--gold), #e6c56c);
      color: #fff;
      border-color: transparent
    }

    .btn:disabled {
      opacity: .5;
      cursor: not-allowed
    }

    .note {
      font-size: 13px;
      color: var(--muted)
    }

    .foot {
      margin-top: 14px;
      font-size: 12px;
      color: var(--muted);
      text-align: center
    }

    .scripture {
      font-style: italic
    }

    .emailbox {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 10px
    }

    input[type="email"] {
      padding: 12px 14px;
      border: 1px solid var(--border);
      border-radius: 12px;
      min-width: 260px
    }

    .center {
      text-align: center
    }

    .hidden {
      display: none !important
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="hero">
      <h1>Marriage Type Assessment <span class="badge">Anonymous</span></h1>
      <p class="subtitle">Answer each statement. We‚Äôll email your result at the end (no results shown on this page).</p>
      <div class="progress" aria-label="Progress">
        <div class="bar" id="bar"></div>
      </div>
      <p class="note" id="progressNote"></p>
    </div>

    <!-- Stepper body -->
    <div class="card" id="stepCard" role="region" aria-live="polite"></div>

    <!-- Email step -->
    <div class="card hidden" id="emailCard">
      <h2 class="section-title">Email my result</h2>
      <p class="note">When you‚Äôve answered all questions, enter your email and tap ‚ÄúSend my result‚Äù.</p>
      <p class="note" style="color:#4b5563">
        Your responses are completely private ‚Äî we can‚Äôt see your answers and we don‚Äôt keep a copy.
        Your result is calculated in your browser and emailed only to you.
      </p>
      <div class="emailbox">
        <input type="email" id="email" placeholder="you@example.com" required />
        <button class="btn primary" id="sendBtn">üì© Send my result</button>
        <button class="btn" id="restartBtn">‚Ü∫ Start over</button>
      </div>
      <p class="note" id="statusNote"></p>
      <div class="foot"><span class="scripture">‚ÄúExcept the Lord build the house, they labour in vain that build it.‚Äù ‚Äî
          Psalm 127:1</span></div>
    </div>

    <!-- Thank you step -->
    <div class="card hidden center" id="thankyou">
      <h2>Check your inbox</h2>
      <p class="note">We‚Äôve emailed your marriage type and stage. If you don‚Äôt see it, check spam/promotions.</p>
      <button class="btn" id="againBtn">Take it again</button>
      <div class="foot"><span class="scripture">‚ÄúExcept the Lord build the house, they labour in vain that build it.‚Äù ‚Äî
          Psalm 127:1</span></div>
    </div>
  </div>

  <script>
    // ---------- CONFIGURE THIS URL ----------
    // Create & deploy a Google Apps Script Web App, then paste its URL here:
    const ENDPOINT_URL = "https://script.google.com/macros/s/AKfycbx3z3A7df8z1zp7uJTbz7GDfWjzUI0WrWX7VNZCrLN0n8nYQOTk_gskqwF2lPV6nCzm/exec";
    // ----------------------------------------

    // Types & stages
    const TYPES = [
      { id: "loveless", name: "Loveless Marriage", stage: "Struggling" },
      { id: "sexless", name: "Sexless Marriage", stage: "Struggling" },
      { id: "dissatisfied", name: "Sexually Dissatisfied Marriage", stage: "Struggling" },
      { id: "toxic", name: "Toxic / One-Sided Marriage", stage: "Struggling" },
      { id: "functional", name: "Functional Marriage (includes Dull)", stage: "Stable" },
      { id: "good", name: "Good Marriage", stage: "Stable" },
      { id: "thriving", name: "Thriving Marriage", stage: "Flourishing" },
      { id: "kingdom", name: "Kingdom-Purpose Marriage", stage: "Flourishing" },
    ];

    const DESCRIPTIONS = {
      loveless: "Emotional warmth has faded; you may feel like housemates. Focus on rebuilding connection and tenderness.",
      sexless: "Physical intimacy is rare or absent. Work on safety, affection, and honest conversation about needs.",
      dissatisfied: "Intimacy happens but lacks emotional closeness or meaning. Reconnect heart-to-heart before and after.",
      toxic: "A relationship marked by imbalance, control, or emotional competition ‚Äî one partner may dominate, manipulate, or keep score instead of working as a team. Replace competition with compassion: you‚Äôre teammates, not opponents. Begin rebuilding safety through forgiveness, honesty, and gentle communication.",
      functional: "Life runs smoothly, but romance and fun may be thin. Move from routine to intentional connection.",
      good: "Healthy, respectful, and loving. Deepen spiritual and emotional intimacy to keep growing.",
      thriving: "Joyful, close, and growing together. Keep rhythms that protect connection and gratitude.",
      kingdom: "Christ-centered unity and shared purpose: your love overflows to bless others."
    };

    // Questions (conversational; toxicity emphasizes competitiveness)
    const QUESTIONS = [
      // Loveless (1‚Äì4)
      { id: 1, text: "We feel emotionally close and connected.", section: "Emotional Connection" },
      { id: 2, text: "We show affection and tenderness often.", section: "Emotional Connection" },
      { id: 3, text: "We talk about more than chores ‚Äî we share our hearts.", section: "Emotional Connection" },
      { id: 4, text: "I feel deeply loved and appreciated by my spouse.", section: "Emotional Connection" },
      // Sexless (5‚Äì7)
      { id: 5, text: "We enjoy regular physical closeness and affection.", section: "Physical Intimacy" },
      { id: 6, text: "One of us tends to pull away from physical affection. (reverse)", section: "Physical Intimacy" },
      { id: 7, text: "We‚Äôre both content with how often we‚Äôre physically intimate.", section: "Physical Intimacy" },
      // Sexually Dissatisfied (8‚Äì10)
      { id: 8, text: "Our intimacy feels close ‚Äî not just physical but emotional.", section: "Emotional Fulfillment" },
      { id: 9, text: "Intimacy sometimes feels like a task, not an expression of love. (reverse)", section: "Emotional Fulfillment" },
      { id: 10, text: "I feel wanted and emotionally close when we‚Äôre intimate.", section: "Emotional Fulfillment" },
      // Toxic / One-Sided (11‚Äì13)
      { id: 11, text: "We compete or keep score instead of collaborating as a team. (reverse)", section: "Emotional Safety" },
      { id: 12, text: "I feel emotionally safe and respected by my spouse.", section: "Emotional Safety" },
      { id: 13, text: "When we disagree, we sometimes try to win instead of understand ‚Äî through criticism or withdrawal. (reverse)", section: "Emotional Safety" },
      // Functional incl Dull (14‚Äì17)
      { id: 14, text: "We make a great team in running our home and life.", section: "Partnership & Rhythm" },
      { id: 15, text: "Our marriage sometimes feels more like a schedule than a love story. (reverse)", section: "Partnership & Rhythm" },
      { id: 16, text: "We make time for each other beyond chores and work.", section: "Partnership & Rhythm" },
      { id: 17, text: "We laugh and have fun together regularly.", section: "Partnership & Rhythm" },
      // Good (18‚Äì21)
      { id: 18, text: "We talk honestly and kindly about what matters.", section: "Healthy Relationship" },
      { id: 19, text: "We cheer each other on and believe in each other‚Äôs dreams.", section: "Healthy Relationship" },
      { id: 20, text: "We handle differences with care and patience.", section: "Healthy Relationship" },
      { id: 21, text: "I feel safe, steady, and content in our relationship.", section: "Healthy Relationship" },
      // Thriving (22‚Äì25)
      { id: 22, text: "We love being together and keep discovering new things about each other.", section: "Joy & Growth" },
      { id: 23, text: "We keep growing closer ‚Äî in heart and in faith.", section: "Joy & Growth" },
      { id: 24, text: "We‚Äôre thankful and joyful for the life we share.", section: "Joy & Growth" },
      { id: 25, text: "When life gets hard, we grow closer instead of apart.", section: "Joy & Growth" },
      // Kingdom (26‚Äì30)
      { id: 26, text: "We pray together and invite God into our decisions.", section: "Kingdom Purpose" },
      { id: 27, text: "We enjoy serving God and others side by side.", section: "Kingdom Purpose" },
      { id: 28, text: "Our marriage feels united by shared faith and purpose.", section: "Kingdom Purpose" },
      { id: 29, text: "We make big decisions together, with prayer and unity.", section: "Kingdom Purpose" },
      { id: 30, text: "Our relationship encourages others and shows God‚Äôs love through us.", section: "Kingdom Purpose" },
    ];

    // Scoring map (reverse=true means 1‚Üî5)
    const MAP = {
      loveless: [{ q: 1, rev: true }, { q: 2, rev: true }, { q: 3, rev: true }, { q: 4, rev: true }],
      sexless: [{ q: 5, rev: true }, { q: 6 }, { q: 7, rev: true }],
      dissatisfied: [{ q: 8, rev: true }, { q: 9 }, { q: 10, rev: true }],
      toxic: [{ q: 11 }, { q: 12, rev: true }, { q: 13 }],
      functional: [{ q: 14 }, { q: 15 }, { q: 16, rev: true }, { q: 17, rev: true }],
      good: [{ q: 18 }, { q: 19 }, { q: 20 }, { q: 21 }],
      thriving: [{ q: 22 }, { q: 23 }, { q: 24 }, { q: 25 }],
      kingdom: [{ q: 26 }, { q: 27 }, { q: 28 }, { q: 29 }, { q: 30 }],
    };

    // Stage groupings
    const STAGES = {
      Struggling: ["loveless", "sexless", "dissatisfied", "toxic"],
      Stable: ["functional", "good"],
      Flourishing: ["thriving", "kingdom"]
    };

    const PRIORITY = ["kingdom", "thriving", "good", "functional", "dissatisfied", "sexless", "loveless", "toxic"];

    const responses = {}; // {qId: 1..5}

    function rev(v) { return 6 - v; }

    function calcPerType() {
      const result = {};
      for (const t of Object.keys(MAP)) {
        const items = MAP[t];
        let sum = 0, count = 0;
        for (const it of items) {
          const v = responses[it.q];
          if (!v) continue;
          sum += it.rev ? rev(v) : v;
          count++;
        }
        result[t] = { sum, count, avg: count ? (sum / count) : 0 };
      }
      return result;
    }

    function calcStageAverages(perType) {
      const stage = {};
      for (const [stageName, list] of Object.entries(STAGES)) {
        let sum = 0, count = 0;
        for (const t of list) {
          sum += perType[t].sum;
          count += perType[t].count;
        }
        stage[stageName] = { sum, count, avg: count ? (sum / count) : 0 };
      }
      return stage;
    }

    function calcRanking(perType) {
      const ordered = Object.keys(perType).sort((a, b) => {
        const diff = perType[b].avg - perType[a].avg;
        return diff !== 0 ? diff : (PRIORITY.indexOf(a) - PRIORITY.indexOf(b));
      });
      return ordered;
    }

    // Stepper state
    let idx = 0; // 0-based index into QUESTIONS

    function setProgress() {
      const answered = Object.keys(responses).length;
      const pct = Math.round(answered / QUESTIONS.length * 100);
      document.getElementById('bar').style.width = pct + '%';
      document.getElementById('progressNote').textContent = `Answered ${answered}/${QUESTIONS.length} (${pct}%)`;
    }

    function renderStep() {
      const card = document.getElementById('stepCard');
      if (idx >= QUESTIONS.length) {
        card.classList.add('hidden');
        document.getElementById('emailCard').classList.remove('hidden');
        document.getElementById('thankyou').classList.add('hidden');
        window.scrollTo({ top: 0, behavior: "smooth" });
        return;
      }
      const q = QUESTIONS[idx];
      const current = responses[q.id] || 0;

      card.innerHTML = `
    <div>
      <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
        <div><span class="qnum">Q${q.id} of ${QUESTIONS.length}</span></div>
        <span class="section">${q.section}</span>
      </div>
      <h2 style="margin:8px 0 0">${q.text}</h2>
      <div class="scale" role="radiogroup" aria-label="Scale for question ${q.id}">
        ${[1, 2, 3, 4, 5].map(v => `
          <label class="opt">
            <input type="radio" name="q${q.id}" value="${v}" ${current === v ? 'checked' : ''} />
            ${["Strongly Disagree", "Disagree", "Neutral", "Agree", "Strongly Agree"][v - 1]}
          </label>
        `).join('')}
      </div>
      <div class="nav">
        <button class="btn" id="backBtn" ${idx === 0 ? 'disabled' : ''}>‚Üê Back</button>
        <button class="btn primary" id="nextBtn" ${current ? '' : 'disabled'}>${idx === QUESTIONS.length - 1 ? 'Finish' : 'Next ‚Üí'}</button>
      </div>
    </div>
  `;

      // interactions
      card.querySelectorAll('input[type=radio]').forEach(inp => {
        inp.addEventListener('change', e => {
          responses[q.id] = Number(inp.value);
          card.querySelector('#nextBtn').disabled = false;
          // Auto-advance after short delay
          setTimeout(() => {
            if (idx < QUESTIONS.length - 1) {
              idx++; renderStep(); setProgress();
            } else {
              // Finish
              idx++; renderStep(); setProgress();
            }
          }, 120);
        });
      });

      card.querySelector('#backBtn').addEventListener('click', () => {
        if (idx > 0) { idx--; renderStep(); }
      });

      card.querySelector('#nextBtn').addEventListener('click', () => {
        if (!responses[q.id]) return;
        if (idx < QUESTIONS.length - 1) { idx++; renderStep(); setProgress(); }
        else { idx++; renderStep(); setProgress(); }
      });
    }

    async function sendEmail() {
      const email = (document.getElementById('email').value || "").trim();
      const note = document.getElementById('statusNote');
      if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        note.textContent = "Please enter a valid email address."; return;
      }
      if (Object.keys(responses).length < QUESTIONS.length) {
        note.textContent = "Please answer all questions before sending your result."; return;
      }

      const perType = calcPerType();
      const ordered = calcRanking(perType);
      const top = ordered[0];
      const stages = calcStageAverages(perType);
      const stageOrder = Object.keys(stages).sort((a, b) => stages[b].avg - stages[a].avg);
      const topStage = stageOrder[0];

      const findType = id => TYPES.find(t => t.id === id);
      const topMeta = findType(top);

      const summary = {
        topType: { id: top, name: topMeta.name, stage: topMeta.stage, description: DESCRIPTIONS[top], avg: +(perType[top].avg || 0).toFixed(2) },
        topStage,
        stageAverages: Object.fromEntries(Object.keys(stages).map(k => [k, +(stages[k].avg || 0).toFixed(2)])),
        scores: Object.fromEntries(Object.keys(perType).map(id => [id, +(perType[id].avg || 0).toFixed(2)])),
        generatedAt: new Date().toISOString()
      };

      const payload = { email, summary };

      note.textContent = "Sending‚Ä¶ please wait.";
      try {
        await fetch(ENDPOINT_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });
        document.getElementById('emailCard').classList.add('hidden');
        document.getElementById('thankyou').classList.remove('hidden');
        window.scrollTo({ top: 0, behavior: "smooth" });
      } catch (err) {
        note.textContent = "We couldn‚Äôt send the email. Please check your connection or try again.";
        console.error(err);
      }
    }

    function restart() {
      for (const k in responses) delete responses[k];
      idx = 0; setProgress();
      document.getElementById('email').value = "";
      document.getElementById('thankyou').classList.add('hidden');
      document.getElementById('emailCard').classList.add('hidden');
      document.getElementById('stepCard').classList.remove('hidden');
      renderStep();
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function init() {
      setProgress();
      renderStep();
      document.getElementById('sendBtn').addEventListener('click', sendEmail);
      document.getElementById('restartBtn').addEventListener('click', restart);
      document.getElementById('againBtn').addEventListener('click', restart);
    }
    init();
  </script>

  <!-- ================= HOW TO ENABLE EMAIL SENDING (Google Apps Script) =================
1) Go to https://script.google.com/ and create a new project.
2) Paste the code below into Code.gs
3) Deploy ‚Üí New deployment ‚Üí Web app
   - Execute as: Me
   - Who has access: Anyone
   - Copy the Web app URL and paste it into ENDPOINT_URL above.
-------------------------- Code.gs --------------------------
function doPost(e) {
  try {
    var data = JSON.parse(e.postData.contents);
    var email = data.email;
    var s = data.summary;

    var subject = "Your Marriage Type Assessment Result";
    var html = ''
      + '<div style="font-family:Arial, sans-serif; line-height:1.6">'
      + '<h2 style="margin:0 0 8px">Your Marriage Type Result</h2>'
      + '<p><strong>Type:</strong> ' + s.topType.name + ' <span style="color:#6d4aa1">(' + s.topType.stage + ')</span></p>'
      + '<p><strong>Average:</strong> ' + s.topType.avg + ' / 5</p>'
      + '<p style="margin:10px 0 0">' + s.topType.description + '</p>'
      + '<hr style="border:none; border-top:1px solid #eee; margin:14px 0">'
      + '<h3 style="margin:0 0 6px">Stage Overview</h3>'
      + '<ul style="padding-left:18px; margin:6px 0">'
      + '<li><strong>Top Stage:</strong> ' + s.topStage + '</li>'
      + '<li>Struggling: ' + (s.stageAverages.Struggling || 0) + '</li>'
      + '<li>Stable: ' + (s.stageAverages.Stable || 0) + '</li>'
      + '<li>Flourishing: ' + (s.stageAverages.Flourishing || 0) + '</li>'
      + '</ul>'
      + '<p style="font-size:12px;color:#6b7280">Generated at ' + s.generatedAt + '</p>'
      + '<p style="font-style:italic; color:#6b7280">‚ÄúExcept the Lord build the house, they labour in vain that build it.‚Äù ‚Äî Psalm 127:1</p>'
      + '</div>';

    MailApp.sendEmail({
      to: email,
      subject: subject,
      htmlBody: html
    });

    return ContentService
      .createTextOutput(JSON.stringify({ ok: true }))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (err) {
    return ContentService
      .createTextOutput(JSON.stringify({ ok: false, error: String(err) }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}
------------------------------------------------------------ -->
</body>

</html>